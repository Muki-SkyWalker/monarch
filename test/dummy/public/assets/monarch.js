((function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=Array.prototype.slice;window.Monarch=function(a,c){b(a,Monarch.Record),a.extended(a);if(c)return a.columns(c)},_.extend(Monarch,{fetchUrl:"/sandbox",resourceUrlRoot:"/",resourceUrlSeparator:"-",Expressions:{},Relations:{},Remote:{},Util:{},fetch:function(){var a,b;return a=1<=arguments.length?c.call(arguments,0):[],(b=Monarch.Remote.Server).fetch.apply(b,a)}})})).call(this),function(){var a=Array.prototype.slice;Monarch.Util.Deferrable=function(){function b(){this._deferrableNodes={},this._deferrableData={},this._deferrableTriggerred={}}return b.prototype.onSuccess=function(a,b){return this.on("success",a,b)},b.prototype.success=function(){var b;return b=1<=arguments.length?a.call(arguments,0):[],this.onSuccess.apply(this,b)},b.prototype.onInvalid=function(a,b){return this.on("invalid",a,b)},b.prototype.onError=function(a,b){return this.on("error",a,b)},b.prototype.triggerSuccess=function(){return this.trigger("success",arguments)},b.prototype.triggerInvalid=function(){return this.trigger("invalid",arguments)},b.prototype.triggerError=function(){return this.trigger("error",arguments)},b.prototype.on=function(a,b,c){var d,e,f;return this._deferrableTriggerred[a]!=null?b.apply(c,this._deferrableData[a]):(d=(f=(e=this._deferrableNodes)[a])!=null?f:e[a]=new Monarch.Util.Node,d.subscribe(b,c)),this},b.prototype.trigger=function(a,b){var c;return this._deferrableTriggerred[a]=!0,this._deferrableData[a]=b,(c=this._deferrableNodes[a])!=null?c.publishArgs(b):void 0},b}()}.call(this),function(){var a;a={plural:[[/(quiz)$/i,"$1zes"],[/^(ox)$/i,"$1en"],[/([m|l])ouse$/i,"$1ice"],[/(matr|vert|ind)ix|ex$/i,"$1ices"],[/(x|ch|ss|sh)$/i,"$1es"],[/([^aeiouy]|qu)y$/i,"$1ies"],[/(hive)$/i,"$1s"],[/(?:([^f])fe|([lr])f)$/i,"$1$2ves"],[/sis$/i,"ses"],[/([ti])um$/i,"$1a"],[/(buffal|tomat)o$/i,"$1oes"],[/(bu)s$/i,"$1ses"],[/(alias|status)$/i,"$1es"],[/(octop|vir)us$/i,"$1i"],[/(ax|test)is$/i,"$1es"],[/s$/i,"s"],[/$/,"s"]],singular:[[/(quiz)zes$/i,"$1"],[/(matr)ices$/i,"$1ix"],[/(vert|ind)ices$/i,"$1ex"],[/^(ox)en/i,"$1"],[/(alias|status)es$/i,"$1"],[/(octop|vir)i$/i,"$1us"],[/(cris|ax|test)es$/i,"$1is"],[/(shoe)s$/i,"$1"],[/(o)es$/i,"$1"],[/(bus)es$/i,"$1"],[/([m|l])ice$/i,"$1ouse"],[/(x|ch|ss|sh)es$/i,"$1"],[/(m)ovies$/i,"$1ovie"],[/(s)eries$/i,"$1eries"],[/([^aeiouy]|qu)ies$/i,"$1y"],[/([lr])ves$/i,"$1f"],[/(tive)s$/i,"$1"],[/(hive)s$/i,"$1"],[/([^f])ves$/i,"$1fe"],[/(^analy)ses$/i,"$1sis"],[/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/i,"$1$2sis"],[/([ti])a$/i,"$1um"],[/(n)ews$/i,"$1ews"],[/s$/i,""]],irregular:[["move","moves"],["sex","sexes"],["child","children"],["man","men"],["person","people"]],uncountable:["sheep","fish","series","species","money","rice","information","equipment"]},Monarch.Util.Inflection={pluralize:function(b){var c,d,e,f,g,h,i,j,k;for(c=0,i=a.uncountable.length;0<=i?c<i:c>i;0<=i?c++:c--){h=a.uncountable[c];if(b.toLowerCase()===h)return h}for(c=0,j=a.irregular.length;0<=j?c<j:c>j;0<=j?c++:c--){g=a.irregular[c][0],d=a.irregular[c][1];if(b.toLowerCase()===g||b===d)return d}for(c=0,k=a.plural.length;0<=k?c<k:c>k;0<=k?c++:c--){e=a.plural[c][0],f=a.plural[c][1];if(e.test(b))return b.replace(e,f)}},singularize:function(b){var c,d,e,f,g,h,i,j,k;for(c=0,i=a.uncountable.length;0<=i?c<i:c>i;0<=i?c++:c--){h=a.uncountable[c];if(b.toLowerCase()===h)return h}for(c=0,j=a.irregular.length;0<=j?c<j:c>j;0<=j?c++:c--){g=a.irregular[c][0],d=a.irregular[c][1];if(b.toLowerCase()===g||b===d)return d}for(c=0,k=a.singular.length;0<=k?c<k:c>k;0<=k?c++:c--){e=a.singular[c][0],f=a.singular[c][1];if(e.test(b))return b.replace(e,f)}},underscore:function(a){return a.replace(/([a-zA-Z\d])([A-Z])/g,"$1_$2").toLowerCase()},camelize:function(a){var b,c,d,e,f,g;b=[],f=a.split("_");for(d=0,g=f.length;d<g;d++)e=f[d],c=d===0?e.charAt(0):e.charAt(0).toUpperCase(),f[d]=c+e.substring(1);return f.join("")},underscoreAndPluralize:function(a){return Monarch.Util.Inflection.underscore(Monarch.Util.Inflection.pluralize(a))},capitalize:function(a){return a.charAt(0).toUpperCase()+a.substr(1)},uncapitalize:function(a){return a.charAt(0).toLowerCase()+a.substr(1)},convertKeysToSnakeCase:function(a){var b,c,d;b={};for(c in a)d=a[c],_.isObject(d)&&(d=Monarch.Util.Inflection.convertKeysToSnakeCase(d)),b[Monarch.Util.Inflection.underscore(c)]=d;return b},convertKeysToCamelCase:function(a){var b,c,d;b={};for(c in a)d=a[c],_.isObject(d)&&(d=Monarch.Util.Inflection.convertKeysToCamelCase(d)),b[Monarch.Util.Inflection.camelize(c,!0)]=d;return b}}}.call(this),function(){(function(a){return a.ajaxSetup({converters:{"json records":function(a){return Monarch.Repository.update(a)},"json records!":function(a){return Monarch.Repository.clear(),Monarch.Repository.update(a)},"json data+records":function(a){return Monarch.Repository.update(a.records),a.data},"json data+records!":function(a){return Monarch.Repository.clear(),Monarch.Repository.update(a.records),a.data}}})})(jQuery)}.call(this),function(){Monarch.Util.Node=function(){function a(){this.clear()}return a.prototype.clear=function(){return this.subscriptions=[]},a.prototype.publish=function(){return this.publishArgs(arguments)},a.prototype.publishArgs=function(a){var b,c,d,e,f;e=this.subscriptions,f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(b.publish(a));return f},a.prototype.subscribe=function(a,b){var c;return c=new Monarch.Util.Subscription(a,b,this),this.subscriptions.push(c),c},a.prototype.unsubscribe=function(a){var b,c;b=this.subscriptions.indexOf(a),b!==-1&&this.subscriptions.splice(b,1);if(this.size()===0)return(c=this.emptyNode)!=null?c.publish():void 0},a.prototype.onEmpty=function(a,b){return this.emptyNode==null&&(this.emptyNode=new Monarch.Util.Node),this.emptyNode.subscribe(a,b)},a.prototype.length=function(){return this.subscriptions.length},a.prototype.size=function(){return this.subscriptions.length},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Monarch.Util.Promise=function(a){function c(){c.__super__.constructor.apply(this,arguments)}return b(c,a),c}(Monarch.Util.Deferrable)}.call(this),function(){var a=Array.prototype.slice;Monarch.Util.Signal=function(){function b(b,c){var d,e,f,g;this.sources=b,this.transformer=c,_.isArray(this.sources)||(this.sources=[this.sources]),this.transformer==null&&(this.transformer=function(){var b;return b=1<=arguments.length?a.call(arguments,0):[],b.join(" ")}),this.changeNode=new Monarch.Util.Node,g=this.sources;for(d=0,f=g.length;d<f;d++)e=g[d],this.subscribeToSource(e,d)}return b.prototype.subscribeToSource=function(a,b){var c=this;return a.onChange(function(a,d){var e,f;return e=c.getSourceValues(),f=_.clone(e),f[b]=d,c.publishChange(e,f)})},b.prototype.publishChange=function(a,b){var c,d;return c=this.transformer.apply(this,a),d=this.transformer.apply(this,b),this.changeNode.publish(c,d)},b.prototype.getValue=function(){return this.transformer.apply(this,this.getSourceValues())},b.prototype.getSourceValues=function(){return _.map(this.sources,function(a){return a.getValue()})},b.prototype.onChange=function(a,b){return this.changeNode.subscribe(a,b)},b}()}.call(this),function(){Monarch.Util.SkipList=function(){function a(a){var b,c;this.comparator=a!=null?a:this.defaultComparator,this.maxLevels=8,this.p=.25,this.currentLevel=0,this.minusInfinity={},this.plusInfinity={},this.head=new Monarch.Util.SkipListNode(this.maxLevels,this.minusInfinity,void 0),this.nil=new Monarch.Util.SkipListNode(this.maxLevels,this.plusInfinity,void 0);for(b=0,c=this.maxLevels;0<=c?b<c:b>c;0<=c?b++:b--)this.head.pointer[b]=this.nil,this.head.distance[b]=1}return a.prototype.insert=function(a,b){var c,d,e,f,g,h,i,j,k,l,m;b==null&&(b=a),h=this.buildNextArray(),i=this.buildNextDistanceArray(),c=this.findClosestNode(a,h,i);if(c.key===a)return c.value=b;e=this.randomLevel();if(e>this.currentLevel){for(d=l=this.currentLevel+1;l<=e?d<=e:d>=e;l<=e?d++:d--)h[d]=this.head;this.currentLevel=e}g=new Monarch.Util.SkipListNode(e,a,b),k=0;for(d=0;0<=e?d<=e:d>=e;0<=e?d++:d--)j=h[d],g.pointer[d]=j.pointer[d],j.pointer[d]=g,g.distance[d]=j.distance[d]-k,j.distance[d]=k+1,k+=i[d];f=this.maxLevels;for(d=m=e+1;m<=f?d<f:d>f;m<=f?d++:d--)h[d].distance[d]+=1;return _.sum(i)},a.prototype.insertAll=function(a){var b,c,d,e;e=[];for(c=0,d=a.length;c<d;c++)b=a[c],e.push(this.insert(b));return e},a.prototype.remove=function(a){var b,c,d,e,f;d=this.buildNextArray(),e=this.buildNextDistanceArray(),b=this.findClosestNode(a,d,e);if(this.compare(b.key,a)===0){for(c=0,f=this.currentLevel;0<=f?c<=f:c>=f;0<=f?c++:c--)d[c].pointer[c]===b?(d[c].pointer[c]=b.pointer[c],d[c].distance[c]+=b.distance[c]-1):d[c].distance[c]-=1;while(this.currentLevel>0&&this.head.pointer[this.currentLevel]===this.nil)this.currentLevel--;return _.sum(e)}return-1},a.prototype.find=function(a){var b;b=this.findClosestNode(a);if(this.compare(b.key,a)===0)return b.value;return},a.prototype.indexOf=function(a){var b,c;return c=this.buildNextDistanceArray(),b=this.findClosestNode(a,null,c),this.compare(b.key,a)===0?_.sum(c):-1},a.prototype.at=function(a){var b,c,d;a+=1,b=this.head;for(c=d=this.currentLevel;d<=0?c<=0:c>=0;d<=0?c++:c--)while(b.distance[c]<=a)a-=b.distance[c],b=b.pointer[c];if(b===this.nil)return;return b.value},a.prototype.keys=function(){var a,b;b=[],a=this.head.pointer[0];while(a!==this.nil)b.push(a.key),a=a.pointer[0];return b},a.prototype.values=function(){var a,b;b=[],a=this.head.pointer[0];while(a!==this.nil)b.push(a.value),a=a.pointer[0];return b},a.prototype.compare=function(a,b){return a===this.minusInfinity?b===this.minusInfinity?0:-1:b===this.minusInfinity?a===this.minusInfinity?0:1:a===this.plusInfinity?b===this.plusInfinity?0:1:b===this.plusInfinity?a===this.plusInfinity?0:-1:this.comparator(a,b)},a.prototype.defaultComparator=function(a,b){return a<b?-1:a>b?1:0},a.prototype.findClosestNode=function(a,b,c){var d,e,f;d=this.head;for(e=f=this.currentLevel;f<=0?e<=0:e>=0;f<=0?e++:e--){while(this.compare(d.pointer[e].key,a)<0)c!=null&&(c[e]+=d.distance[e]),d=d.pointer[e];b!=null&&(b[e]=d)}return d.pointer[0]},a.prototype.randomLevel=function(){var a,b;b=this.maxLevels,a=0;while(Math.random()<this.p&&a<b-1)a++;return a},a.prototype.buildNextArray=function(){var a,b,c;b=new Array(this.maxLevels);for(a=0,c=this.maxLevels;0<=c?a<c:a>c;0<=c?a++:a--)b[a]=this.head;return b},a.prototype.buildNextDistanceArray=function(){var a,b,c;b=new Array(this.maxLevels);for(a=0,c=this.maxLevels;0<=c?a<c:a>c;0<=c?a++:a--)b[a]=0;return b},a}()}.call(this),function(){Monarch.Util.SkipListNode=function(){function a(a,b,c){this.level=a,this.key=b,this.value=c,this.pointer=new Array(a),this.distance=new Array(a)}return a}()}.call(this),function(){Monarch.Util.Subscription=function(){function a(a,b,c){this.callback=a,this.context=b,this.node=c}return a.prototype.publish=function(a){return this.callback.apply(this.context,a)},a.prototype.destroy=function(){return this.node.unsubscribe(this)},a}()}.call(this),function(){Monarch.Util.SubscriptionBundle=function(){function a(){this.subscriptions=[]}return a.prototype.add=function(a){return this.subscriptions.push(a)},a.prototype.destroy=function(){var a,b,c,d;d=this.subscriptions;for(b=0,c=d.length;b<c;b++)a=d[b],a.destroy();return this.subscriptions=[]},a}()}.call(this),function(){_.mixin({sum:function(a){var b,c,d,e;c=0;for(d=0,e=a.length;d<e;d++)b=a[d],c+=b;return c}})}.call(this),function(){var a=Array.prototype.slice;Monarch.Base=function(){function b(){}return b.deriveEquality=function(){var b;return b=1<=arguments.length?a.call(arguments,0):[],this.prototype.isEqual=function(a){var c,d,e;if(a instanceof this.constructor){for(d=0,e=b.length;d<e;d++){c=b[d];if(!_.isEqual(this[c],a[c]))return!1}return!0}return!1}},b.delegate=function(){var b,c,d,e,f,g,h,i,j=this;c=2<=arguments.length?a.call(arguments,0,f=arguments.length-1):(f=0,[]),e=arguments[f++],d=e.to,i=[];for(g=0,h=c.length;g<h;g++)b=c[g],i.push(function(b){return j.prototype[b]=function(){var c,e;return c=1<=arguments.length?a.call(arguments,0):[],(e=this[d])[b].apply(e,c)}}(b));return i},b}()}.call(this),function(){Monarch.CompositeTuple=function(){function a(a,b){this.left=a,this.right=b}return a.prototype.getField=function(a){return this.left.getField(a)||this.right.getField(a)},a.prototype.getFieldValue=function(a){return this.getField(a).getValue()},a.prototype.getRecord=function(a){return this.left.getRecord(a)||this.right.getRecord(a)},a.prototype.toString=function(){return"<"+this.constructor.displayName+" left:"+this.left.toString()+" right:"+this.right.toString()+">"},a}()}.call(this),function(){Monarch.Errors=function(){function a(){this.errorsByField={}}return a.prototype.add=function(a,b){var c;return(c=this.errorsByField)[a]==null&&(c[a]=[]),this.errorsByField[a].push(b)},a.prototype.on=function(a){return this.errorsByField[a]||[]},a.prototype.assign=function(a){this.errorsByField=a},a.prototype.isEmpty=function(){return _.isEmpty(this.errorsByField)},a.prototype.clear=function(a){return delete this.errorsByField[a]},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Monarch.Expressions.Predicate=function(a){function c(a,b){this.left=a,this.right=b}return b(c,a),c.deriveEquality("left","right"),c.forSymbol=function(a){return{"<":Monarch.Expressions.LessThan,"<=":Monarch.Expressions.LessThanOrEqual,">":Monarch.Expressions.GreaterThan,">=":Monarch.Expressions.GreaterThanOrEqual}[a]},c.prototype.evaluate=function(a){var b,c;return b=this.evaluateOperand(this.left,a),c=this.evaluateOperand(this.right,a),this.operator(b,c)},c.prototype.evaluateOperand=function(a,b){return a instanceof Monarch.Expressions.Column?b.getFieldValue(a.qualifiedName):a},c.prototype.resolve=function(a){return new this.constructor(this.resolveOperand(this.left,a),this.resolveOperand(this.right,a))},c.prototype.resolveOperand=function(a,b){return _.isString(a)?b.getColumn(a)||a:a},c.prototype.and=function(a){return new Monarch.Expressions.And(this,a)},c.prototype.wireRepresentation=function(){return{type:this.wireRepresentationType,leftOperand:this.operandWireRepresentation(this.left),rightOperand:this.operandWireRepresentation(this.right)}},c.prototype.operandWireRepresentation=function(a){return a&&_.isFunction(a.wireRepresentation)?a.wireRepresentation():{type:"Scalar",value:a}},c}(Monarch.Base)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Monarch.Expressions.And=function(a){function c(){c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.wireRepresentationType="And",c.prototype.evaluate=function(a){return this.left.evaluate(a)&&this.right.evaluate(a)},c.prototype.satisfyingAttributes=function(){return _.extend(this.left.satisfyingAttributes(),this.right.satisfyingAttributes())},c.prototype.resolve=function(a){return new this.constructor(a.resolvePredicate(this.left),a.resolvePredicate(this.right))},c}(Monarch.Expressions.Predicate)}.call(this),function(){Monarch.Expressions.Column=function(){function a(a,b,c){this.table=a,this.name=b,this.type=c,this.qualifiedName=this.table.name+"."+this.name}return a.prototype.buildLocalField=function(a){return new Monarch.LocalField(a,this)},a.prototype.buildRemoteField=function(a){return new Monarch.RemoteField(a,this)},a.prototype.eq=function(a){return new Monarch.Expressions.Equal(this,a)},a.prototype.wireRepresentation=function(){return{type:"Column",table:this.table.name,name:this.name}},a.prototype.normalizeValue=function(a){return this.type==="datetime"&&_.isNumber(a)?new Date(a):a},a.prototype.valueWireRepresentation=function(a){var b;return this.type==="datetime"&&a?(b=a!=null?a.getTime():void 0)!=null?b:a:a},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Monarch.Expressions.Equal=function(a){function c(){c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.wireRepresentationType="Equal",c.prototype.operator=function(a,b){return _.isEqual(a,b)},c.prototype.satisfyingAttributes=function(){var a;return a={},a[this.left.name]=this.right,a},c.prototype.isEqual=function(a){return a instanceof this.constructor?_.isEqual(this.left,a.left)&&_.isEqual(this.right,a.right)?!0:_.isEqual(this.left,a.right)&&_.isEqual(this.right,a.left)?!0:!1:!1},c}(Monarch.Expressions.Predicate)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Monarch.Expressions.GreaterThan=function(a){function c(){c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.wireRepresentationType="GreaterThan",c.prototype.operator=function(a,b){return a>b},c}(Monarch.Expressions.Predicate)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Monarch.Expressions.GreaterThanOrEqual=function(a){function c(){c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.wireRepresentationType="GreaterThanOrEqual",c.prototype.operator=function(a,b){return a>=b},c}(Monarch.Expressions.Predicate)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Monarch.Expressions.LessThan=function(a){function c(){c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.wireRepresentationType="LessThan",c.prototype.operator=function(a,b){return a<b},c}(Monarch.Expressions.Predicate)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Monarch.Expressions.LessThanOrEqual=function(a){function c(){c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.wireRepresentationType="LessThanOrEqual",c.prototype.operator=function(a,b){return a<=b},c}(Monarch.Expressions.Predicate)}.call(this),function(){Monarch.Expressions.OrderBy=function(){function a(a,b){var c;c=b.split(/\s+/),this.column=a.getColumn(c[0]),this.columnName=this.column.qualifiedName,this.directionCoefficient=c[1]==="desc"?-1:1}return a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Monarch.Expressions.SyntheticColumn=function(a){function c(a,b,c){this.table=a,this.name=b,this.definition=c}return b(c,a),c.prototype.buildLocalField=function(a){return new Monarch.LocalSyntheticField(a,this)},c.prototype.buildRemoteField=function(a){return new Monarch.RemoteSyntheticField(a,this)},c}(Monarch.Expressions.Column)}.call(this),function(){Monarch.Field=function(){function a(a,b){this.record=a,this.column=b,this.name=this.column.name,this.changeNode=new Monarch.Util.Node}return a.prototype.setValue=function(a){var b;return b=this.value,a=this.column.normalizeValue(a),this.value=a,_.isEqual(a,b)||(this.valueChanged(a,b),this.changeNode.publish(a,b)),a},a.prototype.getValue=function(){return this.value},a.prototype.wireRepresentation=function(){return this.column.valueWireRepresentation(this.getValue())},a.prototype.signal=function(a){return new Monarch.Util.Signal(this,a)},a.prototype.onChange=function(a,b){return this.changeNode.subscribe(a,b)},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Monarch.LocalField=function(a){function c(){c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.isDirty=function(){return!_.isEqual(this.getValue(),this.getRemoteValue())},c.prototype.getRemoteValue=function(){return this.record.getRemoteField(this.name).getValue()},c.prototype.valueChanged=function(){return this.record.errors.clear(this.name)},c}(Monarch.Field)}.call(this),function(){Monarch.SyntheticField=function(){function a(a,b){this.record=a,this.column=b,this.name=b.name,this.signal=b.definition.call(a)}return a.prototype.getValue=function(){return this.signal.getValue()},a.prototype.isDirty=function(){return!1},a.prototype.onChange=function(a,b){return this.signal.onChange(a,b)},a}()}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Monarch.LocalSyntheticField=function(a){function c(){c.__super__.constructor.apply(this,arguments)}return b(c,a),c}(Monarch.SyntheticField)}.call(this),function(){var a=Array.prototype.slice;Monarch.Record=function(){function m(a){var b=this;this.table=this.constructor.table,this.errors=new Monarch.Errors,this._associations={},this.localFields={},this.remoteFields={},this.table.eachColumn(function(a){return b.localFields[a.name]=a.buildLocalField(b),b.remoteFields[a.name]=a.buildRemoteField(b)}),a&&this.localUpdate(a),this.afterInitialize()}var b,c,d,e,f,g,h,i,j,k,l=this;j=Monarch.Util.Inflection,d=j.singularize,b=j.capitalize,e=j.uncapitalize,f=j.underscoreAndPluralize,m.extended=function(a){return a.table=Monarch.Repository.buildTable(a),a.defineColumnAccessor("id")},m.resourceUrl=function(a){return Monarch.resourceUrlRoot+f(e(a)).replace(/_/g,Monarch.resourceUrlSeparator)},m.column=function(a,b){return this.table.column(a,b),this.defineColumnAccessor(a),this},m.columns=function(a){var b,c;for(b in a)c=a[b],this.column(b,c);return this},m.syntheticColumn=function(a,b){return this.table.syntheticColumn(a,b),this.prototype[a]=function(){return this.getFieldValue(a)},this},m.hasMany=function(a,c){var f,g,h,i;return c==null&&(c={}),g=(h=c.className)!=null?h:d(b(a)),f=(i=c.foreignKey)!=null?i:e(this.table.name)+"Id",this.relatesTo(a,function(){var a,b,d;return d=Monarch.Repository.tables[g],a=_.extend({},c.conditions||{}),c.through?d=this[c.through]().joinThrough(d):a[f]=this.id(),b=d.where(a),c.orderBy?b.orderBy(c.orderBy):b})},m.relatesTo=function(a,b){return this.prototype[a]=function(){var c,d;return(d=(c=this._associations)[a])!=null?d:c[a]=b.call(this)},this},m.belongsTo=function(a,c){var d,e,f,g;return c==null&&(c={}),e=(f=c.className)!=null?f:b(a),d=(g=c.foreignKey)!=null?g:a+"Id",this.prototype[a]=function(){var a;return a=Monarch.Repository.tables[e],a.find(this[d]())},this},m.defaultOrderBy=function(){return this.table.defaultOrderBy.apply(this.table,arguments),this},m.create=function(a){var b;return b=new this(a),b.save()},m.created=function(a){var b;return b=new this,b.created(a),b},m.defineColumnAccessor=function(a){return this.prototype[a]=function(){var b;return b=this.getField(a),arguments.length===0?b.getValue():b.setValue(arguments[0])}},k=["table","contains","onUpdate","onInsert","onRemove","at","indexOf","where","join","union","difference","limit","offset","orderBy","hasSubscriptions","find","size","getColumn","all","first","last","fetch","clear","findOrFetch"],g=function(b){return m[b]=function(){var c,d;return c=1<=arguments.length?a.call(arguments,0):[],(d=this.table)[b].apply(d,c)}};for(h=0,i=k.length;h<i;h++)c=k[h],g(c);return m.prototype.afterInitialize=_.identity,m.prototype.beforeCreate=_.identity,m.prototype.afterCreate=_.identity,m.prototype.beforeUpdate=_.identity,m.prototype.afterUpdate=_.identity,m.prototype.beforeDestroy=_.identity,m.prototype.afterDestroy=_.identity,m.prototype.getField=function(a){var b;b=a.split(".");if(b.length>1){if(b[0]!==this.table.name)return;a=b[1]}return this.localFields[a]},m.prototype.getFieldValue=function(a){return this.getField(a).getValue()},m.prototype.getRemoteField=function(a){return this.remoteFields[a]},m.prototype.update=function(a){return this.localUpdate(a),this.save()},m.prototype.localUpdate=function(a){var b,c,d;d=[];for(b in a)c=a[b],d.push(typeof this[b]=="function"?this[b](c):void 0);return d},m.prototype.onUpdate=function(a,b){return this.onUpdateNode==null&&(this.onUpdateNode=new Monarch.Util.Node),this.onUpdateNode.subscribe(a,b)},m.prototype.onDestroy=function(a,b){return this.onDestroyNode==null&&(this.onDestroyNode=new Monarch.Util.Node),this.onDestroyNode.subscribe(a,b)},m.prototype.wireRepresentation=function(a){return this.fieldValues(!0,a)},m.prototype.fieldValues=function(a,b){var c,d,e,f;d={},f=this.localFields;for(e in f)c=f[e],a?(b||c.isDirty())&&!(c instanceof Monarch.SyntheticField)&&(d[e]=c.wireRepresentation()):d[e]=c.getValue();return d},m.prototype.created=function(a){return this.updated(a),this.table.insert(this),this.afterCreate()},m.prototype.updated=function(a){var b,c,d,e,f,g,h,i;e=!this.id(),b=this.pendingChangeset={},f=this.table.buildKey(this);for(c in a)g=a[c],(h=this.getRemoteField(c))!=null&&h.setValue(g);return d=this.table.buildKey(this),delete this.pendingChangeset,!e&&!_.isEmpty(b)&&this.table.tupleUpdated(this,b,d,f),this.afterUpdate(),(i=this.onUpdateNode)!=null&&i.publish(b),b},m.prototype.destroyed=function(){var a;return this.table.remove(this),this.afterDestroy(),(a=this.onDestroyNode)!=null?a.publish():void 0},m.prototype.isValid=function(){return this.errors.isEmpty()},m.prototype.isDirty=function(){return _.any(this.localFields,function(a){return a.isDirty()})},m.prototype.isEqual=function(a){return this.constructor===a.constructor&&this.id()===a.id()},m.prototype.save=function(){if(this.id()){if(this.beforeUpdate()===!1)return;return Monarch.Remote.Server.update(this,this.wireRepresentation())}if(this.beforeCreate()===!1)return;return Monarch.Remote.Server.create(this,this.wireRepresentation())},m.prototype.fetch=function(){return this.table.where({id:this.id()}).fetch()},m.prototype.destroy=function(){if(this.beforeDestroy()===!1)return;return Monarch.Remote.Server.destroy(this)},m.prototype.signal=function(){var b,c,d,e,f;return b=2<=arguments.length?a.call(arguments,0,f=arguments.length-1):(f=0,[]),e=arguments[f++],_.isFunction(e)||(b.push(e),e=void 0),c=function(){var a,c,e;e=[];for(a=0,c=b.length;a<c;a++)d=b[a],this.remoteSignals?e.push(this.getRemoteField(d)):e.push(this.getField(d));return e}.call(this),new Monarch.Util.Signal(c,e)},m.prototype.getRecord=function(a){if(this.table.name===a)return this},m.prototype.toString=function(){return"<"+this.constructor.displayName+" "+JSON.stringify(this.fieldValues())+">"},m}.call(this)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=Array.prototype.slice;Monarch.Relations.Relation=function(a){function d(){d.__super__.constructor.apply(this,arguments)}return b(d,a),d.prototype.contents=function(){var a,b,c,d,e,f,g,h;if(this.isActive){if(!this._contents){this._contents=new Monarch.Util.SkipList(this.buildComparator()),g=this._all();for(c=0,e=g.length;c<e;c++)b=g[c],this.insert(b)}return this._contents}a=new Monarch.Util.SkipList(this.buildComparator()),h=this._all();for(d=0,f=h.length;d<f;d++)b=h[d],a.insert(this.buildKey(b),b);return a},d.prototype.all=function(){return this._contents?this._contents.values():this._all()},d.prototype.size=function(){return this.all().length},d.prototype.fetch=function(){return Monarch.Remote.Server.fetch(this)},d.prototype.insert=function(a,b,c){var d;return b==null&&(b=this.buildKey(a)),d=this.contents().insert(b,a),this._insertNode.publish(a,d,b,c||b)},d.prototype.tupleUpdated=function(a,b,c,d){var e,f;return f=this.contents().remove(d),e=this.contents().insert(c,a),this._updateNode.publish(a,b,e,f,c,d)},d.prototype.remove=function(a,b,c,d){var e;return b==null&&(b=c=this.buildKey(a)),e=this.contents().remove(c),this._removeNode.publish(a,e,b,c,d)},d.prototype.isEmpty=function(){return this.all().length===0},d.prototype.contains=function(a){return this.indexOf(a)!==-1},d.prototype.indexOf=function(a){return this.contents().indexOf(this.buildKey(a))},d.prototype.containsKey=function(){var a,b=this;return a=1<=arguments.length?c.call(arguments,0):[],_.any(a,function(a){return b.contents().indexOf(a)!==-1})},d.prototype.findByKey=function(a){return this.contents().find(a)},d.prototype.find=function(a){var b;return b=_.isObject(a)?a:{id:a},this.where(b).first()},d.prototype.at=function(a){return this.contents().at(a)},d.prototype.first=function(){return this.all()[0]},d.prototype.last=function(){return _.last(this.all())},d.prototype.onInsert=function(a,b){return this.activate(),this._insertNode.subscribe(a,b)},d.prototype.onUpdate=function(a,b){return this.activate(),this._updateNode.subscribe(a,b)},d.prototype.onRemove=function(a,b){return this.activate(),this._removeNode.subscribe(a,b)},d.prototype.forEach=function(a,b){return _.each(this.all(),a,b)},d.prototype.each=function(){var a;return a=1<=arguments.length?c.call(arguments,0):[],this.forEach.apply(this,a)},d.prototype.map=function(a,b){return _.map(this.all(),a,b)},d.prototype.where=function(a){return _.isEmpty(a)?this:new Monarch.Relations.Selection(this,a)},d.prototype.join=function(a,b){return new Monarch.Relations.InnerJoin(this,a,b)},d.prototype.project=function(a){return new Monarch.Relations.Projection(this,a)},d.prototype.joinThrough=function(a){return this.join(a).project(a)},d.prototype.union=function(a){return new Monarch.Relations.Union(this,a)},d.prototype.difference=function(a){return new Monarch.Relations.Difference(this,a)},d.prototype.limit=function(a,b){var c;return c=b?this.offset(b):this,new Monarch.Relations.Limit(c,a)},d.prototype.offset=function(a){return new Monarch.Relations.Offset(this,a)},d.prototype.orderBy=function(){return new Monarch.Relations.OrderBy(this,_.flatten(_.toArray(arguments)))},d.prototype.buildComparator=function(a){var b,c;return b=function(a,b){return a!==null&&a!==void 0||b===null||b===void 0?b!==null&&b!==void 0||a===null||a===void 0?a<b:!0:!1},c=this.orderByExpressions,function(d,e){var f,g,h,i,j,k,l;for(k=0,l=c.length;k<l;k++){j=c[k],h=j.columnName,i=j.directionCoefficient,a?(f=d.getFieldValue(h),g=e.getFieldValue(h)):(f=d[h],g=e[h]);if(b(f,g))return-1*i;if(b(g,f))return 1*i}return 0}},d.prototype.buildKey=function(a){var b,c,d,e,f,g;c={},g=this.orderByExpressions;for(e=0,f=g.length;e<f;e++)d=g[e],b=d.columnName,c[b]=a.getFieldValue(b);return c},d.prototype.buildOrderByExpressions=function(a){var b,c,d,e;a=a.concat(["id"]),e=[];for(c=0,d=a.length;c<d;c++)b=a[c],e.push(new Monarch.Expressions.OrderBy(this,b));return e},d.prototype.resolvePredicate=function(a){var b,c,d;return a instanceof Monarch.Expressions.Predicate?a.resolve(this):(c=function(){var c;c=[];for(b in a)d=a[b],c.push(this.predicateForKeyValue(b,d));return c}.call(this),_.inject(c,function(a,b){return a.and(b)}))},d.prototype.predicateForKeyValue=function(a,b){var c,d;return c=a.split(" "),c[1]?(a=c[0],d=Monarch.Expressions.Predicate.forSymbol(c[1])):d=Monarch.Expressions.Equal,(new d(a,b)).resolve(this)},d.prototype.activate=function(){if(!this.isActive)return this._activate()},d.prototype._activate=function(){var a=this;return this._insertNode=new Monarch.Util.Node,this._updateNode=new Monarch.Util.Node,this._removeNode=new Monarch.Util.Node,this._insertNode.onEmpty(function(){return a.deactivateIfNeeded()}),this._updateNode.onEmpty(function(){return a.deactivateIfNeeded()}),this._removeNode.onEmpty(function(){return a.deactivateIfNeeded()}),this.subscriptions=new Monarch.Util.SubscriptionBundle,this.isActive=!0,this.contents()},d.prototype.deactivateIfNeeded=function(){if(!this.hasSubscriptions())return this.deactivate()},d.prototype.deactivate=function(){return delete this._insertNode,delete this._updateNode,delete this._removeNode
,this.subscriptions.destroy(),this.isActive=!1},d.prototype.subscribe=function(a,b,c){return this.subscriptions.add(a[b](c,this))},d.prototype.subscriptionCount=function(){return this.isActive?this._insertNode.size()+this._updateNode.size()+this._removeNode.size():0},d.prototype.hasSubscriptions=function(){return this.subscriptionCount()>0},d}(Monarch.Base)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=Array.prototype.slice;Monarch.Relations.Difference=function(a){function d(a,b){this.left=a,this.right=b,this.orderByExpressions=a.orderByExpressions}return b(d,a),d.deriveEquality("left","right"),d.prototype._all=function(){return _.difference(this.left.all(),this.right.all())},d.prototype._activate=function(){return this.right.activate(),this.left.activate(),d.__super__._activate.apply(this,arguments),this.subscribe(this.left,"onInsert",function(a,b,c,d){if(!this.right.containsKey(c,d))return this.insert(a,c,d)}),this.subscribe(this.right,"onRemove",function(a,b,c,d){if(this.left.containsKey(c,d))return this.insert(a,c,d)}),this.subscribe(this.left,"onUpdate",function(a,b,c,d,e,f){if(!this.right.containsKey(e,f))return this.tupleUpdated(a,b,e,f)}),this.subscribe(this.left,"onRemove",function(a,b,c,d){if(this.containsKey(d))return this.remove(a)}),this.subscribe(this.right,"onInsert",function(a,b,c,d){if(this.containsKey(c,d))return this.remove(a)})},d.prototype.wireRepresentation=function(){return{type:"Difference",leftOperand:this.left.wireRepresentation(),rightOperand:this.right.wireRepresentation()}},d.prototype.getColumn=function(){var a,b;return a=1<=arguments.length?c.call(arguments,0):[],(b=this.left).getColumn.apply(b,a)},d.prototype.inferJoinColumns=function(){var a,b;return a=1<=arguments.length?c.call(arguments,0):[],(b=this.left).inferJoinColumns.apply(b,a)},d.prototype.columns=function(){var a,b;return a=1<=arguments.length?c.call(arguments,0):[],(b=this.left).columns.apply(b,a)},d}(Monarch.Relations.Relation)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Monarch.Relations.InnerJoin=function(a){function c(a,b,c){this.left=_.isFunction(a)?a.table:a,this.right=_.isFunction(b)?b.table:b,this.predicate=this.resolvePredicate(c||this.inferPredicate()),this.orderByExpressions=this.left.orderByExpressions.concat(this.right.orderByExpressions)}return b(c,a),c.deriveEquality("left","right","predicate"),c.prototype.inferPredicate=function(){var a;a=this.left.inferJoinColumns(this.right.columns())||this.right.inferJoinColumns(this.left.columns());if(!a)throw new Error("No join predicate could be inferred");return a[0].eq(a[1])},c.prototype.inferJoinColumns=function(a){return this.left.inferJoinColumns(a)||this.right.inferJoinColumns(a)},c.prototype.columns=function(){return this.left.columns().concat(this.right.columns())},c.prototype.getColumn=function(a){return this.left.getColumn(a)||this.right.getColumn(a)},c.prototype._all=function(){var a,b=this;return a=[],this.left.each(function(c){return b.right.each(function(d){var e;e=b.buildComposite(c,d);if(b.predicate.evaluate(e))return a.push(e)})}),a},c.prototype._activate=function(){return this.left.activate(),this.right.activate(),c.__super__._activate.apply(this,arguments),this.subscribe(this.left,"onInsert",function(a,b,c,d){return this.handleOperandInsert("left",a,d)}),this.subscribe(this.right,"onInsert",function(a,b,c,d){return this.handleOperandInsert("right",a,d)}),this.subscribe(this.left,"onUpdate",function(a,b,c,d,e,f){return this.handleOperandUpdate("left",a,b,f)}),this.subscribe(this.right,"onUpdate",function(a,b,c,d,e,f){return this.handleOperandUpdate("right",a,b,f)}),this.subscribe(this.left,"onRemove",function(a,b,c,d){return this.handleOperandRemove("left",a,d)}),this.subscribe(this.right,"onRemove",function(a,b,c,d){return this.handleOperandRemove("right",a,d)})},c.prototype.otherOperand=function(a){return a==="left"?this.right:this.left},c.prototype.handleOperandInsert=function(a,b,c){var d=this;return this.otherOperand(a).each(function(e){var f,g,h;f=d.buildComposite(b,e,a),g=d.buildKey(f),h=d.buildKey(f,c);if(d.predicate.evaluate(f))return d.insert(f,g,h)})},c.prototype.handleOperandUpdate=function(a,b,c,d){var e=this;return this.otherOperand(a).each(function(f){var g,h,i,j;g=e.buildComposite(b,f,a),i=e.buildKey(g),j=e.buildKey(g,d),h=e.findByKey(j);if(e.predicate.evaluate(g))return h?e.tupleUpdated(h,c,i,j):e.insert(g,i,j);if(h)return e.remove(h,i,j,c)})},c.prototype.handleOperandRemove=function(a,b,c){var d=this;return this.otherOperand(a).each(function(e){var f,g,h,i;g=d.buildComposite(b,e,a),h=d.buildKey(g),i=d.buildKey(g,c),f=d.findByKey(i);if(f)return d.remove(f,h,i)})},c.prototype.buildComposite=function(a,b,c){return c==="right"?new Monarch.CompositeTuple(b,a):new Monarch.CompositeTuple(a,b)},c.prototype.buildKey=function(a,b){var d;return d=c.__super__.buildKey.call(this,a),b?_.extend(d,b):d},c.prototype.wireRepresentation=function(){return{type:"InnerJoin",leftOperand:this.left.wireRepresentation(),rightOperand:this.right.wireRepresentation(),predicate:this.predicate.wireRepresentation()}},c}(Monarch.Relations.Relation)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=Array.prototype.slice;Monarch.Relations.Limit=function(a){function d(a,b){this.operand=a,this.count=b,this.orderByExpressions=a.orderByExpressions}return b(d,a),d.deriveEquality("operand","count"),d.prototype._all=function(){return this.operand.all().slice(0,this.count)},d.prototype._activate=function(){return this.operand.activate(),d.__super__._activate.apply(this,arguments),this.subscribe(this.operand,"onInsert",function(a,b,c,d){var e;if(b<this.count)return e=this.at(this.count-1),e&&this.remove(e),this.insert(a,c,d)}),this.subscribe(this.operand,"onUpdate",function(a,b,c,d,e,f){var g,h;if(d<this.count){if(c<this.count)return this.tupleUpdated(a,b,e,f);this.remove(a,e,f,b),g=this.operand.at(this.count-1);if(g)return this.insert(g)}else if(c<this.count)return h=this.at(this.count-1),h&&this.remove(h),this.insert(a,e,f)}),this.subscribe(this.operand,"onRemove",function(a,b,c,d){var e;this.remove(a,c,d),e=this.operand.at(this.count-1);if(e)return this.insert(e)})},d.prototype.wireRepresentation=function(){return{type:"Limit",operand:this.operand.wireRepresentation(),count:this.count}},d.prototype.getColumn=function(){var a,b;return a=1<=arguments.length?c.call(arguments,0):[],(b=this.operand).getColumn.apply(b,a)},d.prototype.inferJoinColumns=function(){var a,b;return a=1<=arguments.length?c.call(arguments,0):[],(b=this.operand).inferJoinColumns.apply(b,a)},d.prototype.columns=function(){var a,b;return a=1<=arguments.length?c.call(arguments,0):[],(b=this.operand).columns.apply(b,a)},d}(Monarch.Relations.Relation)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=Array.prototype.slice;Monarch.Relations.Offset=function(a){function d(a,b){this.operand=a,this.count=b,this.orderByExpressions=a.orderByExpressions}return b(d,a),d.deriveEquality("operand","count"),d.prototype._all=function(){return this.operand.all().slice(this.count)},d.prototype._activate=function(){return this.operand.activate(),d.__super__._activate.apply(this,arguments),this.subscribe(this.operand,"onInsert",function(a,b,c,d){var e;if(!(b<this.count))return this.insert(a,c,d);e=this.operand.at(this.count);if(e)return this.insert(e)}),this.subscribe(this.operand,"onUpdate",function(a,b,c,d,e,f){var g,h;if(d<this.count){if(c>=this.count)return h=this.at(0),h&&this.remove(h),this.insert(a,e,f)}else{if(!(c<this.count))return this.tupleUpdated(a,b,e,f);this.remove(a,e,f,b),g=this.operand.at(this.count);if(g)return this.insert(g)}}),this.subscribe(this.operand,"onRemove",function(a,b,c,d){var e;if(!(b<this.count))return this.remove(a,c,d);e=this.at(0);if(e)return this.remove(e)})},d.prototype.wireRepresentation=function(){return{type:"Offset",operand:this.operand.wireRepresentation(),count:this.count}},d.prototype.getColumn=function(){var a,b;return a=1<=arguments.length?c.call(arguments,0):[],(b=this.operand).getColumn.apply(b,a)},d.prototype.inferJoinColumns=function(){var a,b;return a=1<=arguments.length?c.call(arguments,0):[],(b=this.operand).inferJoinColumns.apply(b,a)},d.prototype.columns=function(){var a,b;return a=1<=arguments.length?c.call(arguments,0):[],(b=this.operand).columns.apply(b,a)},d}(Monarch.Relations.Relation)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Monarch.Relations.OrderBy=function(a){function c(a,b){this.operand=a,this.orderByExpressions=this.buildOrderByExpressions(b)}return b(c,a),c.deriveEquality("operand","orderByExpressions"),c.delegate("getColumn","inferJoinColumns","columns","wireRepresentation","create","created",{to:"operand"}),c.prototype._all=function(){return this.operand.all().sort(this.buildComparator(!0))},c.prototype._activate=function(){return this.operand.activate(),c.__super__._activate.apply(this,arguments),this.subscribe(this.operand,"onInsert",function(a){return this.insert(a)}),this.subscribe(this.operand,"onUpdate",function(a,b){return this.tupleUpdated(a,b,this.buildKey(a),this.buildKey(a,b))}),this.subscribe(this.operand,"onRemove",function(a,b,c,d,e){return this.remove(a,this.buildKey(a),this.buildKey(a,e))})},c.prototype.buildKey=function(a,b){var d,e,f,g;e=c.__super__.buildKey.call(this,a);if(b)for(f in b)d=b[f],g=d.column.qualifiedName,e[g]!=null&&(e[g]=d.oldValue);return e},c}(Monarch.Relations.Relation)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=Array.prototype.slice;Monarch.Relations.Projection=function(a){function d(a,b){this.operand=a,this.table=_.isFunction(b)?b.table:b,this.buildOrderByExpressions(),this.recordCounts={}}return b(d,a),d.deriveEquality("operand","table"),d.prototype.all=function(){return this._contents?this._contents.values():_.uniq(this._all())},d.prototype._all=function(){var a=this;return this.operand.map(function(b){return b.getRecord(a.table.name)})},d.prototype.buildOrderByExpressions=function(){var a=this;return this.orderByExpressions=_.filter(this.operand.orderByExpressions,function(b){return b.column.table.name===a.table.name})},d.prototype._activate=function(){return this.operand.activate(),d.__super__._activate.apply(this,arguments),this.subscribe(this.operand,"onInsert",function(a,b,c,d){return this.insert(a.getRecord(this.table.name),c,d)}),this.subscribe(this.operand,"onUpdate",function(a,b,c,c,d,e){return this.tupleUpdated(a,b,d,e)}),this.subscribe(this.operand,"onRemove",function(a,b,c,d){return this.remove(a.getRecord(this.table.name),c,d)})},d.prototype.insert=function(a,b){var c,e,f;(e=this.recordCounts)[f=a.id()]==null&&(e[f]=0),c=this.recordCounts[a.id()]+=1;if(c===1)return d.__super__.insert.call(this,a,b)},d.prototype.tupleUpdated=function(a,b,c,e){if(!this.changesetInProjection(b))return;if(this.lastUpdate===b)return;return this.lastUpdate=b,d.__super__.tupleUpdated.call(this,a.getRecord(this.table.name),b,c,e)},d.prototype.remove=function(a,b,c){var e;e=this.recordCounts[a.id()]-=1;if(e===0)return delete this.recordCounts[a.id()],d.__super__.remove.call(this,a,b,c)},d.prototype.changesetInProjection=function(a){return _.values(a)[0].column.table.name===this.table.name},d.prototype.wireRepresentation=function(){return{type:"Projection",operand:this.operand.wireRepresentation(),table:this.table.name}},d.prototype.getColumn=function(){var a,b;return a=1<=arguments.length?c.call(arguments,0):[],(b=this.table).getColumn.apply(b,a)},d.prototype.inferJoinColumns=function(){var a,b;return a=1<=arguments.length?c.call(arguments,0):[],(b=this.table).inferJoinColumns.apply(b,a)},d.prototype.columns=function(){var a,b;return a=1<=arguments.length?c.call(arguments,0):[],(b=this.table).columns.apply(b,a)},d}(Monarch.Relations.Relation)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=Array.prototype.slice;Monarch.Relations.Selection=function(a){function d(a,b){this.operand=a,this.predicate=this.resolvePredicate(b),this.orderByExpressions=a.orderByExpressions}return b(d,a),d.deriveEquality("operand","predicate"),d.prototype.create=function(a){return this.operand.create(_.extend({},a,this.predicate.satisfyingAttributes()))},d.prototype.created=function(a){return this.operand.created(_.extend({},a,this.predicate.satisfyingAttributes()))},d.prototype._all=function(){var a=this;return _.filter(this.operand.all(),function(b){return a.predicate.evaluate(b)})},d.prototype._activate=function(){return this.operand.activate(),d.__super__._activate.apply(this,arguments),this.subscribe(this.operand,"onInsert",function(a,b,c,d){if(this.predicate.evaluate(a))return this.insert(a,c,d)}),this.subscribe(this.operand,"onUpdate",function(a,b,c,c,d,e){if(this.predicate.evaluate(a))return this.containsKey(e)?this.tupleUpdated(a,b,d,e):this.insert(a,d,e);if(this.containsKey(e))return this.remove(a,d,e,b)}),this.subscribe(this.operand,"onRemove",function(a,b,c,d){if(this.containsKey(d))return this.remove(a,c,d)})},d.prototype.wireRepresentation=function(){return{type:"Selection",predicate:this.predicate.wireRepresentation(),operand:this.operand.wireRepresentation()}},d.prototype.getColumn=function(){var a,b;return a=1<=arguments.length?c.call(arguments,0):[],(b=this.operand).getColumn.apply(b,a)},d.prototype.inferJoinColumns=function(){var a,b;return a=1<=arguments.length?c.call(arguments,0):[],(b=this.operand).inferJoinColumns.apply(b,a)},d.prototype.columns=function(){var a,b;return a=1<=arguments.length?c.call(arguments,0):[],(b=this.operand).columns.apply(b,a)},d}(Monarch.Relations.Relation)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=Array.prototype.slice;Monarch.Relations.Table=function(a){function g(a){this.recordClass=a,this.name=a.tableName||a.name,this.columnsByName={},this.column("id","integer"),this.defaultOrderBy("id"),this.activate()}var d,e,f;return b(g,a),f=Monarch.Util.Inflection,d=f.capitalize,e=f.uncapitalize,g.prototype.column=function(a,b){return this.columnsByName[a]=new Monarch.Expressions.Column(this,a,b)},g.prototype.syntheticColumn=function(a,b){return this.columnsByName[a]=new Monarch.Expressions.SyntheticColumn(this,a,b)},g.prototype.getColumn=function(a){var b;b=a.split(".");if(b.length===2){if(b[0]!==this.name)return;a=b[1]}return this.columnsByName[a]},g.prototype.columns=function(){return _.values(this.columnsByName)},g.prototype.eachColumn=function(a,b){return _.each(this.columnsByName,a,b)},g.prototype.defaultOrderBy=function(){return this.orderByExpressions=this.buildOrderByExpressions(_.toArray(arguments)),this._contents=this.buildContents()},g.prototype.buildContents=function(){return new Monarch.Util.SkipList(this.buildComparator())},g.prototype.inferJoinColumns=function(a){var b,c,e,f,g;for(f=0,g=a.length;f<g;f++){b=a[f],e=b.name,c=e.match(/^(.+)Id$/);if(c&&d(c[1])===this.name)return[this.getColumn("id"),b]}},g.prototype.deactivateIfNeeded=function(){},g.prototype.update=function(a){var b,c,d,e,f,g,h;h=[];for(d in a){b=a[d],d=parseInt(d),e={};for(f in b)g=b[f],e[f]=g;c=this.find(d),c?h.push(c.updated(e)):(e.id=d,h.push(this.recordClass.created(e)))}return h},g.prototype.clear=function(){return this._insertNode.clear(),this._updateNode.clear(),this._removeNode.clear(),this._contents=new Monarch.Util.SkipList(this.buildComparator())},g.prototype.resourceUrl=function(){return this.recordClass.resourceUrl(this.name)},g.prototype.wireRepresentation=function(){return{type:"Table",name:this.name}},g.prototype.findOrFetch=function(a){var b,c,d=this;return c=this.find(a),b=new Monarch.Util.Promise,c?b.triggerSuccess(c):Monarch.Remote.Server.fetch(this.where({id:a})).onSuccess(function(){return c=d.find(a),b.triggerSuccess(c)}),b},g.prototype.create=function(){var a,b;return a=1<=arguments.length?c.call(arguments,0):[],(b=this.recordClass).create.apply(b,a)},g.prototype.created=function(){var a,b;return a=1<=arguments.length?c.call(arguments,0):[],(b=this.recordClass).created.apply(b,a)},g}(Monarch.Relations.Relation)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=Array.prototype.slice;Monarch.Relations.Union=function(a){function d(a,b){this.left=a,this.right=b,this.orderByExpressions=this.left.orderByExpressions}return b(d,a),d.deriveEquality("left","right"),d.prototype._all=function(){return _.union(this.left.all(),this.right.all()).sort(this.buildComparator(!0))},d.prototype._activate=function(){return this.left.activate(),this.right.activate(),d.__super__._activate.apply(this,arguments),this.subscribe(this.left,"onInsert",function(a,b,c,d){return this.handleOperandInsert(a,c,d)}),this.subscribe(this.right,"onInsert",function(a,b,c,d){return this.handleOperandInsert(a,c,d)}),this.subscribe(this.left,"onUpdate",function(a,b,c,d,e,f){return this.tupleUpdated(a,b,e,f)}),this.subscribe(this.right,"onUpdate",function(a,b,c,d,e,f){return this.tupleUpdated(a,b,e,f)}),this.subscribe(this.left,"onRemove",function(a,b,c,d){return this.handleOperandRemove("left",a,c,d)}),this.subscribe(this.right,"onRemove",function(a,b,c,d){return this.handleOperandRemove("right",a,c,d)})},d.prototype.handleOperandInsert=function(a,b,c){if(!this.containsKey(b,c))return this.insert(a,b,c)},d.prototype.tupleUpdated=function(a,b,c,e){if(this.lastUpdate===b)return;return this.lastUpdate=b,d.__super__.tupleUpdated.call(this,a,b,c,e)},d.prototype.handleOperandRemove=function(a,b,c,d){var e;e=this.otherOperand(a);if(!e.containsKey(c,d))return this.remove(b,c,d)},d.prototype.otherOperand=function(a){return a==="left"?this.right:this.left},d.prototype.wireRepresentation=function(){return{type:"Union",leftOperand:this.left.wireRepresentation(),rightOperand:this.right.wireRepresentation()}},d.prototype.getColumn=function(){var a,b;return a=1<=arguments.length?c.call(arguments,0):[],(b=this.left).getColumn.apply(b,a)},d.prototype.inferJoinColumns=function(){var a,b;return a=1<=arguments.length?c.call(arguments,0):[],(b=this.left).inferJoinColumns.apply(b,a)},d.prototype.columns=function(){var a,b;return a=1<=arguments.length?c.call(arguments,0):[],(b=this.left).columns.apply(b,a)},d}(Monarch.Relations.Relation)}.call(this),function(){var a,b,c,d=Object.prototype.hasOwnProperty,e=function(a,b){function e(){this.constructor=a}for(var c in b)d.call(b,c)&&(a[c]=b[c]);return e.prototype=b.prototype,a.prototype=new e,a.__super__=b.prototype,a};c=Monarch.Util.Inflection,b=c.convertKeysToSnakeCase,a=c.convertKeysToCamelCase,Monarch.Remote.MutateRequest=function(c){function d(a,b){this.record=a,this.fieldValues=b,d.__super__.constructor.call(this),Monarch.Repository.pauseUpdates(),this.perform()}return e(d,c),d.prototype.perform=function(){var a,c=this;return a=this.requestData(),Monarch.snakeCase&&a!=null&&(a=b(a)),jQuery.ajax({url:this.requestUrl(),type:this.requestType,data:a,dataType:"json",success:function(a){return c.handleSuccess(a)},error:function(a){return c.handleError(a)}})},d.prototype.handleSuccess=function(b){return Monarch.snakeCase&&b!=null&&(b=a(b)),this.triggerSuccess(b)},d.prototype.handleError=function(b){var c;if(b.status===422)return c=JSON.parse(b.responseText),Monarch.snakeCase&&(c=a(c)),this.triggerInvalid(c)},d.prototype.triggerSuccess=function(){return d.__super__.triggerSuccess.apply(this,arguments),Monarch.Repository.resumeUpdates()},d.prototype.triggerInvalid=function(a){return this.record.errors.assign(a),d.__super__.triggerInvalid.call(this,this.record),Monarch.Repository.resumeUpdates()},d}(Monarch.Util.Deferrable)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Monarch.Remote.CreateRequest=function(a){function c(){c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.requestType="post",c.prototype.requestUrl=function(){return this.record.table.resourceUrl()},c.prototype.requestData=function(){if(!_.isEmpty(this.fieldValues))return{fieldValues:this.fieldValues}},c.prototype.triggerSuccess=function(a){return this.record.created(a),c.__super__.triggerSuccess.call(this,this.record)},c}(Monarch.Remote.MutateRequest)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Monarch.Remote.DestroyRequest=function(a){function c(){c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.requestType="delete",c.prototype.requestUrl=function(){return this.record.table.resourceUrl()+"/"+this.record.id()},c.prototype.requestData=function(){},c.prototype.triggerSuccess=function(){return this.record.destroyed(),c.__super__.triggerSuccess.call(this,this.record)},c}(Monarch.Remote.MutateRequest)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b},c=Array.prototype.slice;Monarch.Remote.FetchRequest=function(a){function d(a){d.__super__.constructor.call(this),this.relations=a,this.perform()}return b(d,a),d.prototype.perform=function(){var a,b,d=this;return b=JSON.stringify(function(){var b,c,d,e;d=this.relations,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a.wireRepresentation());return e}.call(this)),jQuery.ajax({url:Monarch.fetchUrl,type:"get",data:{relations:b},dataType:"records",success:function(){var a;return a=1<=arguments.length?c.call(arguments,0):[],d.triggerSuccess.apply(d,a)},error:function(){var a;return a=1<=arguments.length?c.call(arguments,0):[],d.triggerError.apply(d,a)}})},d}(Monarch.Util.Deferrable)}.call(this),function(){Monarch.Remote.Server={create:function(a,b){var c;return c=new Monarch.Remote.CreateRequest(a,b),$.ajaxSettings.async?c:c.record},update:function(a,b){var c;return c=new Monarch.Remote.UpdateRequest(a,b),$.ajaxSettings.async?c:c.record},destroy:function(a){return new Monarch.Remote.DestroyRequest(a)},fetch:function(a){var b;return b=_.isArray(a)?a:_.toArray(arguments),new Monarch.Remote.FetchRequest(b)}}}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Monarch.Remote.UpdateRequest=function(a){function c(){c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.requestType="put",c.prototype.requestUrl=function(){return this.record.table.resourceUrl()+"/"+this.record.id()},c.prototype.requestData=function(){return{fieldValues:this.fieldValues}},c.prototype.triggerSuccess=function(a){var b;return b=this.record.updated(a),c.__super__.triggerSuccess.call(this,this.record,b)},c}(Monarch.Remote.MutateRequest)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Monarch.RemoteField=function(a){function c(){c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.valueChanged=function(a,b){return this.record.pendingChangeset[this.name]={newValue:a,oldValue:b,column:this.column},this.setLocalValue(a,b)},c.prototype.setLocalValue=function(a){return this.record.getField(this.name).setValue(a)},c}(Monarch.Field)}.call(this),function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};Monarch.RemoteSyntheticField=function(a){function c(a,b){var d=this;a.remoteSignals=!0,c.__super__.constructor.call(this,a,b),a.remoteSignals=!1,this.signal.onChange(function(a,b){return d.valueChanged(a,b)})}return b(c,a),c.prototype.valueChanged=function(a,b){return this.record.pendingChangeset[this.name]={newValue:a,oldValue:b,column:this.column}},c}(Monarch.SyntheticField)}.call(this),function(){var a,b,c;c=Monarch.Util.Inflection,a=c.capitalize,b=c.convertKeysToCamelCase,Monarch.Repository={tables:{},pauseCount:0,buildTable:function(a){var b;return b=new Monarch.Relations.Table(a),this.tables[b.name]=b},update:function(c){var d,e,f,g,h,i,j,k;if(this.pauseCount>0){this.deferredUpdates.push(c);return}if(_.isArray(c)){_.isArray(c[0])||(c=[c]),j=[];for(h=0,i=c.length;h<i;h++)d=c[h],e=this["perform"+a(d.shift())],j.push(e.apply(this,d));return j}k=[];for(g in c)f=c[g],Monarch.snakeCase&&(f=b(f)),k.push(this.tables[g].update(f));return k},isPaused:function(){return this.pauseCount>0},pauseUpdates:function(){return this.pauseCount===0&&(this.deferredUpdates=[]),this.pauseCount++},resumeUpdates:function(){var a,b,c,d;this.pauseCount--;if(this.pauseCount===0){d=this.deferredUpdates;for(b=0,c=d.length;b<c;b++)a=d[b],this.update(a);return delete this.deferredUpdates}},performCreate:function(a,c){var d;Monarch.snakeCase&&(c=b(c)),d=this.tables[a];if(d.find(c.id))return;return d.recordClass.created(c)},performUpdate:function(a,c,d){var e,f;return Monarch.snakeCase&&(d=b(d)),f=this.tables[a],e=f.find(parseInt(c)),e!=null?e.updated(d):void 0},performDestroy:function(a,b){var c,d;return d=this.tables[a],c=d.find(parseInt(b)),c!=null?c.destroyed():void 0},clear:function(){var a,b,c,d;this.pauseCount=0,delete this.deferredUpdates,c=this.tables,d=[];for(a in c)b=c[a],d.push(b.clear());return d}}}.call(this);